from src.agent.abstract_agent import Agent
from src.language_models.llm import LLMOutput
from src.correction import Correction
from typing import Dict

class ExploreExploitLPIAgent(Agent):
    def __init__(self, agent_config, task, workspace, num_ex_to_explore=3):
        self.num_ex_to_explore = num_ex_to_explore
        self.history = []
        super().__init__(agent_config, task, workspace) 

    def complete(self, text) -> LLMOutput:
        if len(self.history) == self.num_ex_to_explore:
            prompt = self._task.get_preference_inference_prompt(self.history)
            self._preference = self._llm.respond(prompt).text
        prompt = self._task.get_task_prompt(text, self._preference)
        return self._llm.respond(prompt)

    def learn(self, message, correction: Correction) -> Dict:
        self.history.append(correction)
        return self.metrics(message, correction)
